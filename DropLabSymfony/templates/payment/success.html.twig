{% extends 'base.html.twig' %}

{% block title %}Payment Successful{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card bg-dark border-light text-center">
                <div class="card-body p-4">
                    <!-- Success Message -->
                    <div class="success-animation mb-4">
                        <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                    </div>
                    
                    <h2 class="text-white mb-4">Payment Successful!</h2>
                    <p class="text-light mb-4">
                        {% if payments is defined %}
                            Thank you for your purchase. Your beats are ready for download.
                        {% else %}
                            Thank you for your purchase. Your beat is ready for download.
                        {% endif %}
                    </p>
                    
                    <!-- Transaction Details -->
                    <div class="transaction-details bg-darker p-4 rounded mb-4">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <span class="text-light">Transaction ID:</span>
                            <span class="text-primary">{{ payments is defined ? transactionId : payment.transactionId }}</span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <span class="text-light">Amount Paid:</span>
                            <span class="text-primary">${{ payments is defined ? total : payment.amount }}</span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                            <span class="text-light">Date:</span>
                            <span class="text-primary">{{ (payments is defined ? payments[0].createdAt : payment.createdAt)|date('M d, Y H:i') }}</span>
                        </div>
                    </div>

                    <!-- Purchased Beats -->
                    {% if payments is defined %}
                        <div class="purchased-beats bg-darker p-4 rounded mb-4">
                            <h4 class="text-white mb-3">Purchased Beats</h4>
                            <div class="beats-list">
                                {% for payment in payments %}
                                    <div class="beat-item d-flex align-items-center justify-content-between mb-3">
                                        <div class="d-flex align-items-center">
                                            <img src="{{ asset('uploads/images/covers/' ~ payment.beat.coverImage) }}" 
                                                 alt="{{ payment.beat.title }}" 
                                                 class="rounded me-3"
                                                 style="width: 50px; height: 50px; object-fit: cover;">
                                            <div class="text-start">
                                                <h6 class="text-white mb-1">{{ payment.beat.title }}</h6>
                                            </div>
                                        </div>
                                        <a href="{{ path('payment_download', {'id': payment.id}) }}" 
                                           class="btn btn-outline-primary btn-sm download-btn">
                                            <i class="fas fa-download"></i>
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ path('payment_download', {'id': payment.id}) }}" 
                           class="btn btn-primary btn-lg mb-4 download-btn">
                            <i class="fas fa-download me-2"></i>Download Beat
                        </a>
                    {% endif %}

                    <div class="mt-4">
                        <a href="{{ path('app_beat_index') }}" class="btn btn-outline-light">
                            <i class="fas fa-music me-2"></i>Browse More Beats
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.bg-darker {
    background-color: rgba(0, 0, 0, 0.2);
}

.card {
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
}

.success-animation i {
    animation: scaleIn 0.5s ease-in-out;
}

.btn-outline-light {
    border-color: rgba(255, 255, 255, 0.2);
    color: #ffffff;
}

.btn-outline-light:hover {
    background-color: rgba(255, 255, 255, 0.1);
    transform: translateY(-1px);
}

.transaction-details {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.beats-list {
    max-height: 300px;
    overflow-y: auto;
}

.beats-list::-webkit-scrollbar {
    width: 6px;
}

.beats-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}

.beats-list::-webkit-scrollbar-thumb {
    background: rgba(13, 110, 253, 0.5);
    border-radius: 3px;
}

.beats-list::-webkit-scrollbar-thumb:hover {
    background: rgba(13, 110, 253, 0.7);
}

.beat-item {
    padding: 0.75rem;
    border-radius: 8px;
    transition: background-color 0.2s ease;
}

.beat-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

@keyframes scaleIn {
    from {
        transform: scale(0);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .card-body {
        padding: 2rem 1rem;
    }
    
    .transaction-details {
        padding: 1rem;
    }
}
</style>

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-trigger download after 2 seconds for single beat purchase
    {% if payments is not defined %}
        setTimeout(function() {
            const downloadBtn = document.querySelector('.download-btn');
            if (downloadBtn) {
                downloadBtn.click();
            }
        }, 2000);
    {% endif %}
});
</script>
{% endblock %}
{% endblock %} 